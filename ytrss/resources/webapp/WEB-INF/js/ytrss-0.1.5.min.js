function startVideoTableUpdates(e,a){var t=$("#"+e);$('<div class="text-right"><div class="text-info" style="font-size: 13px; display: inline-block" id="countdown"></div><div class="dropdown" style="display: inline-block; margin-left: 15px"><span class="dropdown-toggle glyphicon glyphicon-th-large" style="cursor:pointer" id="optionMenu" data-toggle="dropdown"></span><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="optionMenu"><li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="forceUpdate()"><span class="glyphicon glyphicon-repeat"></span>Update now</a></li></ul></div></div>').insertAfter(t),$('<div class="text-muted" style="padding-left: 10px; margin-bottom: 20px; display: none;" id="tableEmpty">No videos available</div>').insertAfter(t),updateTable(t,a)}function updateTable(e,a){var t='{"lastUpdate":'+lastVideosUpdate;null!=a&&(t+=',"channel":'+a),t+="}",$.getJSON("/videos",t,function(t){t.videos&&(lastVideosUpdate=t.lastUpdate,loadingIndicatorVisible&&(hideLoadingIndicator(e),loadingIndicatorVisible=!1),updateTableRowCount(e,t.videos.length),updateTableContent(e,t.videos),updateTableEmpty(0==t.videos.length)),updateCountdown(t.countdown),setTimeout(function(){updateTable(e,a)},1e3)}).error(function(){setTimeout(function(){updateTable(e,a)},1e3)})}function hideLoadingIndicator(e){$(e).find("tr").last().remove()}function updateTableEmpty(e){e?$("#tableEmpty").show():$("#tableEmpty").hide()}function updateTableRowCount(e,a){var t=$(e).find("tr").length-1;if(a>t)for(var n=t;a>n;n++){for(var o=document.createElement("tr"),i=0;5>i;i++){var l=document.createElement("td");o.appendChild(l)}e.find("tbody").get(0).appendChild(o)}else if(t>a)for(var s=$(e).find("tr"),n=t;n>a;n--){var o=s[n-1];$(o).remove()}}function updateTableContent(e,a){var t=0!=window.showChannels;$(e).find("tbody").find("tr").each(function(e){var n=a[e],o=$(this).find("td");$(o[0]).text(n.uploaded),t&&$(o[1]).html('<a href="channel/'+n.channelID+'">'+n.channelName+"</a>"),$(o[t?2:1]).html('<a href="http://youtube.com/watch?v='+n.youtubeID+'">'+n.name+"</a>");var i="";switch(n.state){case 3:case 6:i+='<a class="table-state-label" href="#" onclick="window.alert(\''+n.errorMessage+"')\">";break;case 7:i+='<a class="table-state-label" href="download?id='+n.id+"&token="+n.securityToken+'">'}switch(i+='<span class="label table-state-label ',n.state){case 0:case 2:case 5:i+="label-info";break;case 3:case 6:i+="label-danger";break;case 7:i+="label-success";break;default:i+="label-default"}switch(i+='">',i+='<i class="glyphicon ',n.state){case 0:i+="glyphicon-info-sign";break;case 1:case 4:i+="glyphicon-time";break;case 2:i+="glyphicon-download";break;case 3:case 6:i+="glyphicon-warning-sign";break;case 5:i+="glyphicon-record";break;case 7:i+="glyphicon-ok";break;case 8:i+="glyphicon glyphicon-remove"}switch(i+='"></i>',n.state){case 0:i+="New";break;case 1:i+="DL enqueued";break;case 2:i+="Downloading";break;case 3:i+="DL failed";break;case 4:i+="TRC enqueued";break;case 5:i+="Transcoding";break;case 6:i+="TRC failed";break;case 7:i+="Ready";break;case 8:i+="Deleted"}i+="</span>",(3==n.state||6==n.state||7==n.state)&&(i+="</a>"),$(o[t?3:2]).html(i);var l=!1,s='<div class="dropdown"><span class="dropdown-toggle glyphicon glyphicon-th-large" style="cursor:pointer" id="videoOptionMenu'+n.id+'" data-toggle="dropdown"></span><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="videoOptionMenu'+n.id+'">';7==n.state&&(s+='<li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="stream('+n.id+')"><span class="glyphicon glyphicon-play"></span> Stream</a></li>'),(4==n.state||6==n.state||7==n.state||8==n.state)&&(s+='<li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="resetVideo('+n.id+')"><span class="glyphicon glyphicon-repeat"></span> Reset</a></li>',l=!0),2!=n.state&&5!=n.state&&8!=n.state&&(s+='<li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="deleteVideo('+n.id+')"><span class="glyphicon glyphicon-trash"></span> Delete</a></li>',l=!0),s+="</ul></div>",$(o[t?4:3]).html(l?s:'<span class="glyphicon glyphicon-th-large" style="opacity:0.05;filter:alpha(opacity=05)"></span>')})}function resetVideo(e){$.get("/videos/reset?id="+e)}function forceUpdate(){$.get("/videos/forceUpdate")}function deleteVideo(e){$.get("/videos/delete?id="+e)}function stream(e){return popup=window.open("/stream?id="+e,"ytrss - Stream","width=550,height=100,resizable=yes"),popup.focus(),!1}function updateCountdown(e){var a=e/1e3;if(0==e)$("#countdown").text("Updating...");else{var t=Math.floor(a/60),n=Math.floor(a%60),o="Next update in: "+t;o+=1==t?" minute":" minutes",o+=" and "+n,o+=1==n?" second":" seconds",$("#countdown").text(o)}}var lastVideosUpdate=-1,loadingIndicatorVisible=!0;