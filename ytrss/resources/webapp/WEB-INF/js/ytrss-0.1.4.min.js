var lastVideosUpdate=-1;var loadingIndicatorVisible=true;function startVideoTableUpdates(b,c){var a=$("#"+b);$('<div class="text-right"><div class="text-info" style="font-size: 13px; display: inline-block" id="countdown"></div><div class="dropdown" style="display: inline-block; margin-left: 15px"><span class="dropdown-toggle glyphicon glyphicon-th" style="cursor:pointer" id="optionMenu" data-toggle="dropdown"></span><ul class="dropdown-menu" role="menu" aria-labelledby="optionMenu"><li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="forceUpdate()"><span class="glyphicon glyphicon-repeat"></span>Update now</a></li></ul></div></div>').insertAfter(a);$('<div class="text-muted" style="padding-left: 10px; margin-bottom: 20px; display: none;" id="tableEmpty">No videos available</div>').insertAfter(a);updateTable(a,c)}function updateTable(b,c){var a='{"lastUpdate":'+lastVideosUpdate;if(c!=null){a+=',"channel":'+c}a+="}";$.getJSON("/videos",a,function(d){if(d.videos){lastVideosUpdate=d.lastUpdate;if(loadingIndicatorVisible){hideLoadingIndicator(b);loadingIndicatorVisible=false}updateTableRowCount(b,d.videos.length);updateTableContent(b,d.videos);updateTableEmpty(d.videos.length==0)}updateCountdown(d.countdown);setTimeout(function(){updateTable(b,c)},1000)}).error(function(){setTimeout(function(){updateTable(b,c)},1000)})}function hideLoadingIndicator(a){$(a).find("tr").last().remove()}function updateTableEmpty(a){if(a){$("#tableEmpty").show()}else{$("#tableEmpty").hide()}}function updateTableRowCount(e,g){var d=$(e).find("tr").length-1;if(g>d){for(var c=d;c<g;c++){var f=document.createElement("tr");for(var b=0;b<5;b++){var h=document.createElement("td");f.appendChild(h)}e.find("tbody").get(0).appendChild(f)}}else{if(g<d){var a=$(e).find("tr");for(var c=d;c>g;c--){var f=a[c-1];$(f).remove()}}}}function updateTableContent(c,a){var b=window.showChannels!=false;$(c).find("tbody").find("tr").each(function(e){var h=a[e];var f=$(this).find("td");$(f[0]).text(h.uploaded);if(b){$(f[1]).html('<a href="channel/'+h.channelID+'">'+h.channelName+"</a>")}$(f[b?2:1]).html('<a href="http://youtube.com/watch?v='+h.youtubeID+'">'+h.name+"</a>");var j="";switch(h.state){case 3:case 6:j+='<a class="table-state-label" href="#" onclick="window.alert(\''+h.errorMessage+"')\">";break;case 7:j+='<a class="table-state-label" href="download?id='+h.id+"&token="+h.securityToken+'">';break}j+='<span class="label table-state-label ';switch(h.state){case 0:case 2:case 5:j+="label-info";break;case 3:case 6:j+="label-danger";break;case 7:j+="label-success";break;default:j+="label-default";break}j+='">';j+='<i class="glyphicon ';switch(h.state){case 0:j+="glyphicon-info-sign";break;case 1:case 4:j+="glyphicon-time";break;case 2:j+="glyphicon-download";break;case 3:case 6:j+="glyphicon-warning-sign";break;case 5:j+="glyphicon-record";break;case 7:j+="glyphicon-ok";break;case 8:j+="glyphicon glyphicon-remove";break}j+='"></i>';switch(h.state){case 0:j+="New";break;case 1:j+="DL enqueued";break;case 2:j+="Downloading";break;case 3:j+="DL failed";break;case 4:j+="TRC enqueued";break;case 5:j+="Transcoding";break;case 6:j+="TRC failed";break;case 7:j+="Ready";break;case 8:j+="Deleted";break}j+="</span>";if(h.state==3||h.state==6||h.state==7){j+="</a>"}$(f[b?3:2]).html(j);var g=false;var d='<div class="dropdown"><span class="dropdown-toggle glyphicon glyphicon-th" style="cursor:pointer" id="videoOptionMenu'+h.id+'" data-toggle="dropdown"></span><ul class="dropdown-menu" role="menu" aria-labelledby="videoOptionMenu'+h.id+'">';if(h.state==7){d+='<li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="stream('+h.id+')"><span class="glyphicon glyphicon-play"></span> Stream</a></li>'}if(h.state==4||h.state==6||h.state==7||h.state==8){d+='<li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="resetVideo('+h.id+')"><span class="glyphicon glyphicon-repeat"></span> Reset</a></li>';g=true}if(h.state!=2&&h.state!=5&&h.state!=8){d+='<li role="presentation"><a role="menuitem" tabindex="-1" style="text-decoration: none" href="javascript:void()" onclick="deleteVideo('+h.id+')"><span class="glyphicon glyphicon-trash"></span> Delete</a></li>';g=true}d+="</ul></div>";$(f[b?4:3]).html(g?d:'<span class="glyphicon glyphicon-th" style="opacity:0.05;filter:alpha(opacity=05)"></span>')})}function resetVideo(a){$.get("/videos/reset?id="+a)}function forceUpdate(){$.get("/videos/forceUpdate")}function deleteVideo(a){$.get("/videos/delete?id="+a)}function stream(a){popup=window.open("/stream?id="+a,"ytrss - Stream","width=550,height=100,resizable=yes");popup.focus();return false}function updateCountdown(c){var e=c/1000;if(c==0){$("#countdown").text("Updating...")}else{var b=Math.floor(e/60);var a=Math.floor(e%60);var d="Next update in: "+b;if(b==1){d+=" minute"}else{d+=" minutes"}d+=" and "+a;if(a==1){d+=" second"}else{d+=" seconds"}$("#countdown").text(d)}};